
- defaults:
    clean:
        force: true
    link:
        create: true
        force: true
        relink: true 


- sudo:
    - shell:
        description: Updating grub
        command: >
            datestamp=$(date +%y%m%d%H%M);
            cp /etc/default/grub /etc/default/grub.$datestamp.bak;
            sed -E "
                s/^GRUB_TIMEOUT_STYLE=.+/GRUB_TIMEOUT_STYLE=menu/;
                s/^GRUB_TIMEOUT=.+/GRUB_TIMEOUT=5/;
                s/^GRUB_CMDLINE_LINUX_DEFAULT.+/GRUB_CMDLINE_LINUX_DEFAULT=\"\"/
            " /etc/default/grub > newgrub;
    - shell:
        description: Disable CUPS
        command: >
            if [ systemctl is-active cups ]; then
                systemctl stop cups;
                systemctl disable cups;
                echo cups disabled;
            fi;
            if [ systemctl is-active cups-browsed ]; then
                systemctl stop cups-browsed;
                systemctl disable cups-browsed;
                echo cups-browsed disabled;
            fi;


- clean: ['~/','~/bin','~/.config']


- create:
    - ~/bin
    - ~/bin/i3blocklets
    - ~/repos
    - ~/.themes


# TODO Can this flag be set by some other means?
- shell:
    - [touch ~/.primaryhost, Create the primary host flag]


- link:
    ~/:
        path: home/.*
        glob: true
    ~/bin/:
        path: lib/scripts/*
        glob: true
        exclude:
            - lib/scripts/LICENSE
            - lib/scripts/npdisksetup
            - lib/scripts/save-the-change
    ~/bin/quickemu:
        path: lib/quickemu/quickemu
        if: "which snap &&  snap list | grep '^qemu-virgil'"
    ~/.config: ~
    ~/Downloads: /tmp
    ~/tmp: /tmp
    ~/toby:
        path: /nfs/home/$USER
        ignore-missing: true
    ~/.vim: ~
    ~/VirtualBoxVMs:
        path: /mnt/vmdrive/$USER/virtualbox
        ignore-missing: true


- shell:
    - [cd lib/my-i3blocklets; ./deploy, Installing i3blocklets]


# Install theme files
- shell:
    - command: cd ~; ls .dotfiles/themes/*.tar.gz | head -n 1 | xargs tar -vxf
      description: Installing theme files
      stderr: true
